function getPrettyDate(e){let t=new Date,n=String(t.getDate()).padStart(2,"0"),i=String(t.getMonth()+1).padStart(2,"0"),o=t.getFullYear(),r=new Date(1e3*e),a=r.getFullYear(),s=("0"+(r.getMonth()+1)).slice(-2),c=("0"+r.getDate()).slice(-2),d=("0"+r.getHours()).slice(-2),l=("0"+r.getMinutes()).slice(-2);if(n==c&&i==s&&o==a)return d+":"+l;{const e="default";return r.format(e)}}var dateFormat=function(){var e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,t=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,i=function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e};return function(o,r,a,s){var c=dateFormat;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(o)||/\d/.test(o)||(r=o,o=void 0),o=o?new Date(o):new Date,isNaN(o))throw SyntaxError("invalid date");"UTC:"==(r=String(c.masks[r]||r||c.masks.default)).slice(0,4)&&(r=r.slice(4),a=!0);var d=a?"getUTC":"get",l=o[d+"Date"](),u=o[d+"Day"](),m=o[d+"Month"](),p=o[d+"FullYear"](),g=o[d+"Hours"](),f=o[d+"Minutes"](),h=o[d+"Seconds"](),v=o[d+"Milliseconds"](),y=a?0:o.getTimezoneOffset(),S={d:l,dd:i(l),ddd:s.dayNames[u],dddd:s.dayNames[u+7],m:m+1,mm:i(m+1),mmm:s.monthNames[m],mmmm:s.monthNames[m+12],yy:String(p).slice(2),yyyy:p,h:g%12||12,hh:i(g%12||12),H:g,HH:i(g),M:f,MM:i(f),s:h,ss:i(h),l:i(v,3),L:i(v>99?Math.round(v/10):v),t:g<12?"a":"p",tt:g<12?"am":"pm",T:g<12?"A":"P",TT:g<12?"AM":"PM",Z:a?"UTC":(String(o).match(t)||[""]).pop().replace(n,""),o:(y>0?"-":"+")+i(100*Math.floor(Math.abs(y)/60)+Math.abs(y)%60,4),S:["th","st","nd","rd"][l%10>3?0:(l%100-l%10!=10)*l%10]};return r.replace(e,(function(e){return e in S?S[e]:e.slice(1,e.length-1)}))}}();function checkMinuteTimer(e){setTimeout((function(){subscrInterval-=1,postData("server/script.php",{type:"updatepayment",subscr_interval_count:subscrInterval,agentId:agentId}).then((e=>{e.text().then((function(e){if(subscrInterval>0){if(checkMinuteTimer(6e4),subscrInterval<=2){const e=1===subscrInterval?smartVideo.msgStore.minute:smartVideo.msgStore.minutes;setNotify("info",smartVideo.msgStore.meetingExpiredInTwoMinutes.replace(/{{number}}/g,subscrInterval)+e,"top",5e3,!1)}}else setNotify("info",smartVideo.msgStore.meetingExpired,"top",5e3,!1),setTimeout((function(){exit()}),2e3)}))}))}),e)}function checkTimer(){const e=datetime||Date.now();let t=new Date(e);t.setMinutes(t.getMinutes()+parseInt(duration));const n=new Date;setTimeout((function(){const e=new Date(t).getTime();let n=!1;function i(e){setNotify("info",e,"top",6e5,!1,!1)}!function t(){setTimeout((function(){const o=(new Date).getTime(),r=e-o;let a=Math.floor(r%864e5/36e5),s=Math.floor(r%36e5/6e4),c=Math.floor(r%6e4/1e3);s&&c<10&&(c="0"+c),a=a?a+":":"",s=s?s+":":"";const d=a+s+c,l=smartVideo.msgStore.meetingEndsIn.replace("{{timemeeting}}",d);n?document.querySelector(".notyf__message").innerText=l:(i(l),document.getElementsByClassName("notyf")[2].style.opacity="0.5"),n=!0,r<0?i(smartVideo.msgStore.meetingExpired):t()}),1e3)}()}),t-n-12e4)}function startMeetingTimer(e){meetingTimerLength>0&&(meetingTimer=setTimeout((()=>{saveLog("timeout"),saveLog("ended"),updateStatus("info",smartVideo.msgStore.timeOutMeeting),setTimeout((()=>{exit()}),5e3)}),e))}function checkAppointment(){let e=Date.now();datetime&&(e=datetime);let t=new Date,n=new Date(e);if(n.setMinutes(n.getMinutes()+parseInt(duration)),t>=new Date(e)&&n>t){let e=n-new Date;return checkTimer(),setTimeout((function(){exit()}),e),!0}{let n=new Date,i=new Date(e),o=Math.abs(i-n)/1e3,r=Math.floor(o/86400);o-=86400*r;let a=Math.floor(o/3600)%24;o-=3600*a;let s=Math.floor(o/60)%60;o-=60*s;let c="";if(r>0){c=r+" "+(r>1?smartVideo.msgStore.days:smartVideo.msgStore.day)}if(0===r&&a>0){c=a+" "+(a>1?smartVideo.msgStore.hours:smartVideo.msgStore.hour)}if(0===r&&0==a&&s>0&&(c=s+" "+smartVideo.msgStore.minutes),0===r&&0==a&&0==s&&(c=smartVideo.msgStore.seconds),c&&new Date(e)>t){let t=smartVideo.msgStore.notexactAppointment,n=getPrettyDate(new Date(e).getTime()/1e3),i=t.replace("{{timemeeting}}",n);i=i.replace("{{diffString}}",c),setNotify("info",i,"top",6e5);let o=new Date,r=new Date(e)-o;r<2147483640&&setTimeout((function(){window.location.reload()}),r)}else setNotify("info",smartVideo.msgStore.appointmentPast,"top",6e5);return!1}}dateFormat.masks={default:"dd-mm-yyyy HH:MM",shortDate:"m/d/yy HH:MM",mediumDate:"mmm d, yyyy HH:MM",longDate:"mmmm d, yyyy HH:MM",fullDate:"dddd, mmmm d, yyyy HH:MM",isoDate:"yyyy-mm-dd HH:MM",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},Date.prototype.format=function(e,t){let n={dayNames:[smartVideo.msgStore.Sun,smartVideo.msgStore.Mon,smartVideo.msgStore.Tue,smartVideo.msgStore.Wed,smartVideo.msgStore.Thu,smartVideo.msgStore.Fri,smartVideo.msgStore.Sat,smartVideo.msgStore.Sunday,smartVideo.msgStore.Monday,smartVideo.msgStore.Tuesday,smartVideo.msgStore.Wednesday,smartVideo.msgStore.Thursday,smartVideo.msgStore.Friday,smartVideo.msgStore.Saturday],monthNames:[smartVideo.msgStore.Jan,smartVideo.msgStore.Feb,smartVideo.msgStore.Mar,smartVideo.msgStore.Apr,smartVideo.msgStore.May,smartVideo.msgStore.Jun,smartVideo.msgStore.Jul,smartVideo.msgStore.Aug,smartVideo.msgStore.Sep,smartVideo.msgStore.Oct,smartVideo.msgStore.Nov,smartVideo.msgStore.Dec,smartVideo.msgStore.January,smartVideo.msgStore.February,smartVideo.msgStore.March,smartVideo.msgStore.April,smartVideo.msgStore.May,smartVideo.msgStore.June,smartVideo.msgStore.July,smartVideo.msgStore.August,smartVideo.msgStore.September,smartVideo.msgStore.October,smartVideo.msgStore.November,smartVideo.msgStore.December]};return dateFormat(this,e,t,n)};"use strict";!function(){var e,t="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";if(y="object"==typeof process&&"object"==typeof process.versions&&process.versions.node&&!process.browser){var n=process.versions.node.toString().replace("v","");t="Nodejs/"+n+" (NodeOS) AppleWebKit/"+n+" (KHTML, like Gecko) Nodejs/"+n+" Nodejs/"+n}e="undefined"!=typeof global?global:window,"undefined"==typeof window&&("undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:t,getUserMedia:function(){}},e.window=global),"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(e.screen={width:0,height:0}));var i=window.navigator;void 0!==i?(void 0!==i.webkitGetUserMedia&&(i.getUserMedia=i.webkitGetUserMedia),void 0!==i.mozGetUserMedia&&(i.getUserMedia=i.mozGetUserMedia)):i={getUserMedia:function(){},userAgent:t};var o=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(i.userAgent||""),r=!(-1===i.userAgent.indexOf("Edge")||!i.msSaveOrOpenBlob&&!i.msSaveBlob),a=!!window.opera||i.userAgent.indexOf(" OPR/")>=0,s=i.userAgent.toLowerCase().indexOf("firefox")>-1&&"netscape"in window&&/ rv:/.test(i.userAgent),c=/^((?!chrome|android).)*safari/i.test(i.userAgent),d=!!window.chrome&&!a,l="undefined"!=typeof document&&!!document.documentMode&&!r;function u(e,t){var n=0,i=!1,o=window.setInterval((function(){e()&&(window.clearInterval(o),t(i)),n++>50&&(window.clearInterval(o),t(i=!0))}),10)}var m={Android:function(){return i.userAgent.match(/Android/i)},BlackBerry:function(){return i.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return i.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return i.userAgent.match(/Opera Mini/i)},Windows:function(){return i.userAgent.match(/IEMobile/i)},any:function(){return m.Android()||m.BlackBerry()||m.iOS()||m.Opera()||m.Windows()},getOsName:function(){var e="Unknown OS";return m.Android()&&(e="Android"),m.BlackBerry()&&(e="BlackBerry"),m.iOS()&&(e="iOS"),m.Opera()&&(e="Opera Mini"),m.Windows()&&(e="Windows"),e}};var p="Unknown OS",g="Unknown OS Version";var f,h,v=function(){for(var e,t=i.appVersion,n=i.userAgent,o="-",r=[{s:"Chrome OS",r:/CrOS/},{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],a=0;e=r[a];a++)if(e.r.test(n)){o=e.s;break}var s="-";switch(/Windows/.test(o)&&(/Windows (.*)/.test(o)&&(s=/Windows (.*)/.exec(o)[1]),o="Windows"),o){case"Mac OS X":/Mac OS X (10[\.\_\d]+)/.test(n)&&(s=/Mac OS X (10[\.\_\d]+)/.exec(n)[1]);break;case"Android":/Android ([\.\_\d]+)/.test(n)&&(s=/Android ([\.\_\d]+)/.exec(n)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(n)&&(s=/OS (\d+)_(\d+)_?(\d+)?/.exec(t))&&s.length>3&&(s=s[1]+"."+s[2]+"."+(0|s[3]))}return{osName:o,osVersion:s}}();v&&v.osName&&"-"!=v.osName?(p=v.osName,g=v.osVersion):m.any()&&"Android"==(p=m.getOsName())&&(g=!!(h=(f=(f||i.userAgent).toLowerCase()).match(/android\s([0-9\.]*)/))&&h[1]);var y="object"==typeof process&&"object"==typeof process.versions&&process.versions.node;"Unknown OS"===p&&y&&(p="Nodejs",g=process.versions.node.toString().replace("v",""));var S=!1,w=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach((function(e){"undefined"!=typeof document&&"function"==typeof document.createElement&&(!S&&e in document.createElement("canvas")&&(S=!0),!w&&e in document.createElement("video")&&(w=!0))}));var b=/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/,M=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,A=/[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}/;var C=[],k=[],_=[],T=[];i.mediaDevices&&i.mediaDevices.enumerateDevices&&(i.enumerateDevices=function(e){var t=i.mediaDevices.enumerateDevices();t&&t.then?i.mediaDevices.enumerateDevices().then(e).catch((function(){e([])})):e([])});var x=!1;("undefined"!=typeof MediaStreamTrack&&"getSources"in MediaStreamTrack||i.mediaDevices&&i.mediaDevices.enumerateDevices)&&(x=!0);var R=!1,E=!1,B=!1,O=!1,L=!1;function D(e){if(x)if(!i.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(i.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!i.enumerateDevices&&i.enumerateDevices&&(i.enumerateDevices=i.enumerateDevices.bind(i)),i.enumerateDevices){C=[],k=[],_=[],T=[],R=!1,E=!1,B=!1,O=!1,L=!1;var t={};i.enumerateDevices((function(n){C=[],k=[],_=[],T=[],n.forEach((function(e){var n={};for(var i in e)try{"function"!=typeof e[i]&&(n[i]=e[i])}catch(e){}t[n.deviceId+n.label+n.kind]||("audio"===n.kind&&(n.kind="audioinput"),"video"===n.kind&&(n.kind="videoinput"),n.deviceId||(n.deviceId=n.id),n.id||(n.id=n.deviceId),n.label?("videoinput"!==n.kind||L||(L=!0),"audioinput"!==n.kind||O||(O=!0)):(n.isCustomLabel=!0,"videoinput"===n.kind?n.label="Camera "+(T.length+1):"audioinput"===n.kind?n.label="Microphone "+(k.length+1):"audiooutput"===n.kind?n.label="Speaker "+(_.length+1):n.label="Please invoke getUserMedia once.",void 0!==I&&I.browser.isChrome&&I.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(n.label="HTTPs is required to get label of this "+n.kind+" device.")),"audioinput"===n.kind&&(R=!0,-1===k.indexOf(n)&&k.push(n)),"audiooutput"===n.kind&&(E=!0,-1===_.indexOf(n)&&_.push(n)),"videoinput"===n.kind&&(B=!0,-1===T.indexOf(n)&&T.push(n)),C.push(n),t[n.deviceId+n.label+n.kind]=n)})),void 0!==I&&(I.MediaDevices=C,I.hasMicrophone=R,I.hasSpeakers=E,I.hasWebcam=B,I.isWebsiteHasWebcamPermissions=L,I.isWebsiteHasMicrophonePermissions=O,I.audioInputDevices=k,I.audioOutputDevices=_,I.videoInputDevices=T),e&&e()}))}else e&&e();else e&&e()}var I=window.DetectRTC||{};I.browser=function(){i.appVersion;var e,t,n,o=i.userAgent,u=i.appName,m=""+parseFloat(i.appVersion),p=parseInt(i.appVersion,10);if(a){u="Opera";try{p=(m=i.userAgent.split("OPR/")[1].split(" ")[0]).split(".")[0]}catch(e){m="0.0.0.0",p=0}}else l?((t=o.indexOf("rv:"))>0?m=o.substring(t+3):(t=o.indexOf("MSIE"),m=o.substring(t+5)),u="IE"):d?(t=o.indexOf("Chrome"),u="Chrome",m=o.substring(t+7)):c?-1!==o.indexOf("CriOS")?(t=o.indexOf("CriOS"),u="Chrome",m=o.substring(t+6)):-1!==o.indexOf("FxiOS")?(t=o.indexOf("FxiOS"),u="Firefox",m=o.substring(t+6)):(t=o.indexOf("Safari"),u="Safari",m=o.substring(t+7),-1!==(t=o.indexOf("Version"))&&(m=o.substring(t+8)),-1!==i.userAgent.indexOf("Version/")&&(m=i.userAgent.split("Version/")[1].split(" ")[0])):s?(t=o.indexOf("Firefox"),u="Firefox",m=o.substring(t+8)):(e=o.lastIndexOf(" ")+1)<(t=o.lastIndexOf("/"))&&(u=o.substring(e,t),m=o.substring(t+1),u.toLowerCase()===u.toUpperCase()&&(u=i.appName));return r&&(u="Edge",m=i.userAgent.split("Edge/")[1]),-1!==(n=m.search(/[; \)]/))&&(m=m.substring(0,n)),p=parseInt(""+m,10),isNaN(p)&&(m=""+parseFloat(i.appVersion),p=parseInt(i.appVersion,10)),{fullVersion:m,version:p,name:u,isPrivateBrowsing:!1}}(),function(e){var t;try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,(function(){t=!1}),(function(e){t=!0}));else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var n;try{(n=window.indexedDB.open("test")).onerror=function(){return!0}}catch(e){t=!0}void 0===t&&u((function(){return"done"===n.readyState}),(function(e){e||(t=!n.result)}))}else if(function(e){var t=e.toLowerCase();if(0===t.indexOf("msie")&&0===t.indexOf("trident"))return!1;var n=/(?:msie|rv:)\s?([\d\.]+)/.exec(t);return!!(n&&parseInt(n[1],10)>=10)}(window.navigator.userAgent)){t=!1;try{window.indexedDB||(t=!0)}catch(e){t=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(e){t=!0}void 0===t&&(t=!1,window.localStorage.removeItem("test"))}}catch(e){t=!1}u((function(){return void 0!==t}),(function(n){e(t)}))}((function(e){I.browser.isPrivateBrowsing=!!e})),I.browser["is"+I.browser.name]=!0,I.osName=p,I.osVersion=g;"object"==typeof process&&"object"==typeof process.versions&&process.versions["node-webkit"];var V=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach((function(e){V||e in window&&(V=!0)})),I.isWebRTCSupported=V,I.isORTCSupported="undefined"!=typeof RTCIceGatherer;var N=!1;((I.browser.isChrome&&I.browser.version>=35||I.browser.isFirefox&&I.browser.version>=34||I.browser.isEdge&&I.browser.version>=17||"Android"===I.osName&&I.browser.isChrome)&&(N=!0),(i.getDisplayMedia||i.mediaDevices&&i.mediaDevices.getDisplayMedia)&&(N=!0),/^(https:|chrome-extension:)$/g.test(location.protocol||""))||("undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(I.browser.isChrome||I.browser.isEdge||I.browser.isOpera)||I.browser.isFirefox)&&(N=!1);I.isScreenCapturingSupported=N;var P={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach((function(e){P.isSupported||e in window&&(P.isSupported=!0,window[e]&&"createMediaStreamSource"in window[e].prototype&&(P.isCreateMediaStreamSourceSupported=!0))})),I.isAudioContextSupported=P.isSupported,I.isCreateMediaStreamSourceSupported=P.isCreateMediaStreamSourceSupported;var F=!1;I.browser.isChrome&&I.browser.version>31&&(F=!0),I.isRtpDataChannelsSupported=F;var W=!1;(I.browser.isFirefox&&I.browser.version>28||I.browser.isChrome&&I.browser.version>25||I.browser.isOpera&&I.browser.version>=11)&&(W=!0),I.isSctpDataChannelsSupported=W,I.isMobileDevice=o;var U=!1;(i.getUserMedia||i.mediaDevices&&i.mediaDevices.getUserMedia)&&(U=!0),I.browser.isChrome&&I.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(U="Requires HTTPs"),"Nodejs"===I.osName&&(U=!1),I.isGetUserMediaSupported=U;var H,j,z,$="";screen.width&&($+=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:""));I.displayResolution=$,I.displayAspectRatio=(H=screen.width,j=screen.height,z=function e(t,n){return 0==n?t:e(n,t%n)}(H,j),H/z/(j/z)).toFixed(2),I.isCanvasSupportsStreamCapturing=S,I.isVideoSupportsStreamCapturing=w,"Chrome"==I.browser.name&&I.browser.version>=53&&(I.isCanvasSupportsStreamCapturing||(I.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),I.isVideoSupportsStreamCapturing||(I.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features")),I.DetectLocalIPAddress=function(e,t){if(I.isWebRTCSupported){var n=!0,i=!0;!function(e,t){if("undefined"==typeof document||"function"!=typeof document.getElementById)return;var n={},i=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!i){var o=document.getElementById("iframe");if(!o)return;var r=o.contentWindow;i=r.RTCPeerConnection||r.mozRTCPeerConnection||r.webkitRTCPeerConnection}if(!i)return;var a=null;"Chrome"===I.browser&&I.browser.version<58&&(a={optional:[{RtpDataChannels:!0}]});var s=new i({iceServers:[{urls:"stun:stun.l.google.com:19302"}]},a);t&&(s.addStream?s.addStream(t):s.addTrack&&t.getTracks()[0]&&s.addTrack(t.getTracks()[0],t));function c(t){if(t){var i=M.exec(t);if(i){var o=i[1],r=t.match(b),a=!0;void 0===n[o]&&e(o,r,a),n[o]=!0}}else e()}if(s.onicecandidate=function(e){e.candidate&&e.candidate.candidate?c(e.candidate.candidate):c()},!t)try{s.createDataChannel("sctp",{})}catch(e){}I.isPromisesSupported?s.createOffer().then((function(e){s.setLocalDescription(e).then(d)})):s.createOffer((function(e){s.setLocalDescription(e,d,(function(){}))}),(function(){}));function d(){s.localDescription.sdp.split("\n").forEach((function(e){e&&0===e.indexOf("a=candidate:")&&c(e)}))}}((function(t){t?t.match(b)?e("Local: "+t,n=!1,i):t.match(A)?e("Public: "+t,n,i=!1):e("Public: "+t,n,i):e()}),t)}},I.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,I.isWebSocketsBlocked=!I.isWebSocketsSupported,"Nodejs"===I.osName&&(I.isWebSocketsSupported=!0,I.isWebSocketsBlocked=!1),I.checkWebSocketsSupport=function(e){e=e||function(){};try{var t,n=new WebSocket("wss://echo.websocket.org:443/");n.onopen=function(){I.isWebSocketsBlocked=!1,t=(new Date).getTime(),n.send("ping")},n.onmessage=function(){I.WebsocketLatency=(new Date).getTime()-t+"ms",e(),n.close(),n=null},n.onerror=function(){I.isWebSocketsBlocked=!0,e()}}catch(t){I.isWebSocketsBlocked=!0,e()}},I.load=function(e){D(e=e||function(){})},I.MediaDevices=void 0!==C?C:[],I.hasMicrophone=R,I.hasSpeakers=E,I.hasWebcam=B,I.isWebsiteHasWebcamPermissions=L,I.isWebsiteHasMicrophonePermissions=O,I.audioInputDevices=k,I.audioOutputDevices=_,I.videoInputDevices=T;var J=!1;"undefined"!=typeof document&&"function"==typeof document.createElement&&"setSinkId"in document.createElement("video")&&(J=!0),I.isSetSinkIdSupported=J;var G=!1;I.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(G=!0):I.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(G=!0),I.isRTPSenderReplaceTracksSupported=G;var q=!1;I.browser.isFirefox&&I.browser.version>38&&(q=!0),I.isRemoteStreamProcessingSupported=q;var X=!1;"undefined"!=typeof MediaStreamTrack&&"applyConstraints"in MediaStreamTrack.prototype&&(X=!0),I.isApplyConstraintsSupported=X;var K=!1;I.browser.isFirefox&&I.browser.version>=43&&(K=!0),I.isMultiMonitorScreenCapturingSupported=K,I.isPromisesSupported=!!("Promise"in window),I.version="1.4.1",void 0===I&&(window.DetectRTC={});var Y=window.MediaStream;void 0===Y&&"undefined"!=typeof webkitMediaStream&&(Y=webkitMediaStream),I.MediaStream=void 0!==Y&&"function"==typeof Y&&Object.keys(Y.prototype),"undefined"!=typeof MediaStreamTrack?I.MediaStreamTrack=Object.keys(MediaStreamTrack.prototype):I.MediaStreamTrack=!1;var Q=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;I.RTCPeerConnection=void 0!==Q&&Object.keys(Q.prototype),window.DetectRTC=I,"undefined"!=typeof module&&(module.exports=I),"function"==typeof define&&define.amd&&define("DetectRTC",[],(function(){return I}))}();let speech,transcriptTimer,timeoutLength,talkArray=[],peer_name="Me",peer_id="Me",liveStorage=window.localStorage,canUnmute=!0,stopSpeech=!1;function updateStatus(e,t,n=5e3){setNotify(e,t,"top",n)}function startSpeech(e){e?(recognition.lang=pageLanguage,recognition.start()):recognition.stop()}function greetVoice(){mediaElement.play();let e=liveStorage.getItem("peer_name");if(videoGreetingText&&e!==peer_name){videoGreetingText=videoGreetingText.replace(/{{name}}/g,peer_name);let e=videoGreetingText.split("|");canUnmute=!1;let t=e[0],n=e[1];if(n){const e=n.split("~");n=e.length>1?getDefaultLanguage(e):e[0]}const i=t.split("~");t=i.length>1?getDefaultLanguage(i):i[0],setTimeout((()=>{talkHandler(t),setMsgAvatar("left",videoAvatarName),appendMessage("left",leftMsgAvatar,videoAvatarName,"chatgpt",t,peer_id,peer_name,!0),n&&appendMessage("left",leftMsgAvatar,videoAvatarName,"chatgpt",n,peer_id,peer_name,!0),cleanMessage(),liveStorage.setItem("peer_name",peer_name)}),1500)}if(videoAiSuggestions){const e=videoAiSuggestions.split(",");display(suggestionContainer,!0),e.forEach((e=>{let t='<a href="#" class="suggestions" onclick="sendSuggestion(\''+e+"')\">"+e+"</a>";suggestionContainer.insertAdjacentHTML("beforeend",t)}))}}async function getSessionToken(){const e=await fetch("server/script.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"createtoken",hg:hg})}),t=await e.json();!t||0===Object.keys(t).length||t.error?(updateStatus("error",smartVideo.msgStore.errorCreatingAvatar),saveLog(t.error),saveLog("failed"),setTimeout((()=>{exit()}),5e3)):t.code&&100!==t.code?(10013===t.code?updateStatus("warning",smartVideo.msgStore.avatarNotAllowed):10007===t.code?updateStatus("warning",smartVideo.msgStore.userSessionLimit):400112===t.code?updateStatus("error",smartVideo.msgStore.errorTaskAvatar):updateStatus("warning",smartVideo.msgStore.errorTaskAvatarPlease),saveLog(t.code+" "+t.message),saveLog("failed"),setTimeout((()=>{exit()}),5e3)):sessionToken=t.data.token}async function connectWebSocket(e){const t=new URLSearchParams({session_id:e,session_token:sessionToken,silence_response:!1,stt_language:pageLanguage}),n=`wss://${new URL(API_CONFIG.serverUrl).hostname}/v1/ws/streaming.chat?${t}`;webSocket=new WebSocket(n),webSocket.addEventListener("message",(e=>{JSON.parse(e.data)}))}async function startNewSession(){try{const e=await fetch(`${API_CONFIG.serverUrl}/v1/streaming.new`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${sessionToken}`},body:JSON.stringify({quality:videoAiQuality,avatar_name:videoAvatar,voice:{voice_id:videoVoice,rate:1},version:"v2",video_encoding:"H264"})}),t=await e.json();saveLog("start new session"),videoAiInfo=t.data,room=new LivekitClient.Room({adaptiveStream:!0,dynacast:!0,videoCaptureDefaults:{resolution:LivekitClient.VideoPresets.h720.resolution}}),room.on(LivekitClient.RoomEvent.DataReceived,(e=>{const t=(new TextDecoder).decode(e),n=JSON.parse(t);"avatar_start_talking"===n.type&&(chatSpeechStartButton.classList.remove("activeControl"),speechRecognition&&startSpeech(!1)),"avatar_stop_talking"===n.type&&(talkArray.length>0?(showTranscribeMessage(videoAvatarName+": "+talkArray[0]),talkHandler(talkArray[0])):(display(translateMessage,!1),translateMessage.innerHTML="",!speechRecognition||stopSpeech||isAudio||(chatSpeechStartButton.classList.add("activeControl"),startSpeech(!0))),display(stopButton,!1),canUnmute=!0)})),mediaStream=new MediaStream,room.on(LivekitClient.RoomEvent.TrackSubscribed,(e=>{"video"!==e.kind&&"audio"!==e.kind||(mediaStream.addTrack(e.mediaStreamTrack),mediaStream.getVideoTracks().length>0&&mediaStream.getAudioTracks().length>0&&(mediaElement.srcObject=mediaStream,videoBackground&&renderCanvas(),mediaElement.onloadedmetadata=()=>{mediaElement.play().catch(console.error)}))})),room.on(LivekitClient.RoomEvent.TrackUnsubscribed,(e=>{const t=e.mediaStreamTrack;t&&mediaStream.removeTrack(t)})),room.on(LivekitClient.RoomEvent.Disconnected,(e=>{saveLog(`Room disconnected: ${e}`),exit()})),await room.prepareConnection(videoAiInfo.url,videoAiInfo.access_token),await connectWebSocket(videoAiInfo.session_id),await startStreamingSession()}catch(e){updateStatus("error",e),saveLog(e),saveLog("failed"),setTimeout((()=>{exit()}),5e3)}}async function createNewSession(){updateStatus("info",smartVideo.msgStore.creatingNewSession,2e4),await getSessionToken(),sessionToken&&await startNewSession()}async function startStreamingSession(){await fetch(`${API_CONFIG.serverUrl}/v1/streaming.start`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${sessionToken}`},body:JSON.stringify({session_id:videoAiInfo.session_id})});setNotify("info",smartVideo.msgStore.sessionCreationCompleted,"bottom",5e3),await room.connect(videoAiInfo.url,videoAiInfo.access_token),greetVoice()}function sendSuggestion(e){chatMessage.value=e,chatSendButton.click()}function getDefaultLanguage(e){let t=navigator.language||navigator.userLanguage;var n;return t=t.substring(0,2),e.forEach((e=>{const i=e.split("^");"default"!==i[0].trim()&&i[0].trim()!==t||(n=i[1].trim(),i[0].trim()===t&&postData("server/script.php",{type:"setlanguage",lang:t}))})),n}async function talkHandler(e){if(videoAiInfo||isAudio){clearTimeout(meetingTimer),meetingTimer=0,talkArray.shift();try{if(e){let t=(e=e.replace(/(<([^>]+)>)/gi,"")).replace(/&quot;/g,"").replace(/&amp;/g,"").replace(/&gt;/g,"").replace(/&lt;/g,"");chatSpeechStartButton.classList.remove("activeControl"),speechRecognition&&startSpeech(!1),canUnmute=!1;let n=isAudio?"server/script.php":`${API_CONFIG.serverUrl}/v1/streaming.task`;audioSession=Math.random().toString(36).slice(2).substring(0,10);let i=isAudio?audioSession:videoAiInfo.session_id;await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${sessionToken}`},body:JSON.stringify({session_id:i,text:t,voice:videoVoice,elabs:elabs,type:"getvoice"})}).then((n=>{n.text().then((function(n){if(n=JSON.parse(n),isAudio){if(n.data&&n.data.duration_ms){const e=document.createElement("audio");e.canPlayType("audio/mpeg")&&e.setAttribute("src","server/audiofiles/"+audioSession+".mp3"),e.play(),setTimeout((()=>{postData("server/script.php",{type:"deletevoice",session_id:audioSession})}),2e3)}else if(n.data&&0===n.data.length){let e=new SpeechSynthesisUtterance;e.lang=videoVoice,e.rate=1,e.volume=1,e.pitch=1,e.text=t,window.speechSynthesis.speak(e)}n.detail&&n.detail.message&&setNotify("error",n.detail.message,"top",1e4),canUnmute=!0}isAudio||(timeoutLength=1e3+1.1*n.data.duration_ms,startMeetingTimer(timeoutLength+meetingTimerLength),display(stopButton,!0)),showTranscribeMessage(videoAvatarName+": "+e),0===n.data.duration_ms?setNotify("info",smartVideo.msgStore.errorTaskAvatarPlease,"top",1e4):n.data.duration_ms<500&&talkHandler(smartVideo.msgStore.cannotVoice)}))})).catch((e=>{updateStatus("error",smartVideo.msgStore.errorCreatingAvatar)}))}else updateStatus("error",smartVideo.msgStore.errorTaskAvatar)}catch(e){updateStatus("error",smartVideo.msgStore.errorTaskAvatar)}}else updateStatus("warning",smartVideo.msgStore.errorCreatingAvatar)}async function interrupt(){if(videoAiInfo||isAudio){if(!canUnmute&&!isAudio)try{display(stopButton,!1),display(translateMessage,!1);await fetch(`${API_CONFIG.serverUrl}/v1/streaming.interrupt`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${sessionToken}`},body:JSON.stringify({session_id:videoAiInfo.session_id})})}catch(e){updateStatus("error",smartVideo.msgStore.errorTaskAvatar)}}else updateStatus("warning",smartVideo.msgStore.errorCreatingAvatar)}async function closeConnectionHandler(){hideElement(canvasElement);try{if(videoAiInfo&&videoAiInfo.session_id){await fetch(`${API_CONFIG.serverUrl}/v1/streaming.stop`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${sessionToken}`},body:JSON.stringify({session_id:videoAiInfo.session_id})});videoAiInfo=null,await stopRecording(),webSocket&&webSocket.close(),room&&room.disconnect(),mediaElement.srcObject=null,room=null,mediaStream=null,sessionToken=null}isAudio&&postData("server/script.php",{type:"deletevoice",session_id:audioSession})}catch(e){console.error("Failed to close the connection:",e)}}function calculateFeathering(e,t,n,i){let o=0,r=0;for(let a=-i;a<=i;a++)for(let s=-i;s<=i;s++){const i=e+4*(a*n+s);i>=0&&i<t.length&&(o+=t[i+3],r++)}return o/r}function sharpenImage(e,t,n){const i=[0,-.5,0,-.45,3,-.45,0,-.5,0],o=new ImageData(new Uint8ClampedArray(e.data),t,n),r=o.data;for(let o=1;o<n-1;o++)for(let n=1;n<t-1;n++){const a=4*(o*t+n);for(let s=0;s<3;s++){let c=0;for(let r=-1;r<=1;r++)for(let a=-1;a<=1;a++){const d=3*(r+1)+(a+1),l=4*((o+r)*t+(n+a))+s;c+=e.data[l]*i[d]}r[a+s]=Math.max(0,Math.min(255,c))}}return o}function renderCanvas(){if(canvasElement.style.display="block",mediaElement.style.display="none","Safari"===DetectRTC.browser.name){function e(e){const t=canvasElement.getContext("2d",{willReadFrequently:!0,alpha:!0});if(canvasElement.parentElement.style.background=`url("${videoBackground}") center / cover no-repeat`,!t||mediaElement.readyState<2)return;canvasElement.width=mediaElement.videoWidth,canvasElement.height=mediaElement.videoHeight,t.clearRect(0,0,canvasElement.width,canvasElement.height),t.drawImage(mediaElement,0,0,canvasElement.width,canvasElement.height);const n=t.getImageData(0,0,canvasElement.width,canvasElement.height),i=n.data;for(let t=0;t<i.length;t+=4){const n=i[t],o=i[t+1],r=i[t+2],a=Math.max(n,o,r),s=a-Math.min(n,o,r);let c=0;c=0===s?0:a===n?(o-r)/s%6:a===o?(r-n)/s+2:(n-o)/s+4,c=Math.round(60*c),c<0&&(c+=360);const d=0===a?0:s/a,l=a/255;if(c>=e.minHue&&c<=e.maxHue&&d>e.minSaturation&&l>.15&&o>n*e.threshold&&o>r*e.threshold){const e=(o-Math.max(n,r))/(o||1),a=Math.max(0,1-4*e);i[t+3]=a<.2?0:Math.round(255*a)}}t.putImageData(n,0,0)}const t={minHue:90,maxHue:120,minSaturation:.1,threshold:1};let n=null;const i=()=>{e(t),n=requestAnimationFrame(i)};return i(),()=>{null!==n&&cancelAnimationFrame(n)}}{let e=2;Math.trunc(1e9*Math.random());const t=canvasElement.getContext("2d",{willReadFrequently:!0});function n(){if(canvasElement.width=mediaElement.videoWidth,canvasElement.height=mediaElement.videoHeight,0===canvasElement.width)return void requestAnimationFrame(n);t.drawImage(mediaElement,0,0,canvasElement.width,canvasElement.height),t.getContextAttributes().willReadFrequently=!0;let i=t.getImageData(0,0,canvasElement.width,canvasElement.height);DetectRTC.isMobileDevice&&(i=sharpenImage(i,canvasElement.width,canvasElement.height));const o=i.data;for(let t=0;t<o.length;t+=4){const n=o[t],i=o[t+1],r=o[t+2],a=i>n&&i>r,s=i-Math.max(n,r),c=20,d=80;if(a&&s>d)o[t+3]=0;else if(a&&s>c){const e=1-(s-c)/(d-c);o[t+3]=Math.round(255*e)}else o[t+3]=calculateFeathering(t,o,canvasElement.width,e)}t.putImageData(i,0,0),requestAnimationFrame(n)}canvasElement.parentElement.style.background=`url("${videoBackground}") center / cover no-repeat`,setTimeout(n,2e3)}}function hideElement(e){e.hidden=!0}function showElement(e){e.hidden=!1}const canvasElement=document.querySelector("#canvasElement");function setTooltip(e,t,n,i=!1){if(!DetectRTC.isMobileDevice){var o=document.getElementById(e);if(o){o.title=t,o.dataset.bsPlacement=n;var r=new bootstrap.Tooltip(o,{boundary:document.body,trigger:"hover"});o.addEventListener("click",(function(e){r.hide()})),o.addEventListener("mouseout",(function(e){r.hide()}))}}}function setLocale(e,t){document.getElementById(e).innerHTML=t}function setValue(e,t){document.getElementById(e).value=t}function setImageTitle(e,t){document.getElementById(e).title=t}function setPlaceholder(e,t){document.getElementById(e).placeholder=t}function initRoom(){if(saveLog("start"),speechRecognition)try{display(chatSpeechStartButton,!0),chatSpeechStartButton.onclick=()=>{chatSpeechStartButton.classList.contains("activeControl")?startSpeech(!1):canUnmute&&(stopSpeech=!1,startSpeech(!0))}}catch(e){console.log(e)}DetectRTC.isMobileDevice||(setTooltip("chatSpeechStartButton",smartVideo.msgStore.chatSpeechStart,"top"),setTooltip("chatButton",smartVideo.msgStore.startChat,"top"),setTooltip("exitButton",smartVideo.msgStore.exitMeeting,"top"),setTooltip("stopButton",smartVideo.msgStore.stopSpeech,"top"),setTooltip("chatSendButton",smartVideo.msgStore.send,"top"),setTooltip("chatCloseButton",smartVideo.msgStore.close,"bottom"),setTooltip("languageButton",smartVideo.msgStore.languageButton,"top"),setTooltip("recordingButton",smartVideo.msgStore.recordingButton,"top"),setTooltip("stopRecordingButton",smartVideo.msgStore.stopRecordingButton,"top")),setLocale("pleaseWait",smartVideo.msgStore.pleaseWait),setPlaceholder("chatMessage",smartVideo.msgStore.chatMessage),videoAiName.innerHTML="&nbsp;"+videoAvatarName,attendeeName.innerHTML=videoAvatarName;var e=genAvatarSvg(videoAvatarName,32);e=`<img src="${e}" alt="${videoAvatarName}"></img>`,attendeeAvatar.innerHTML=e,function(){display(videoMediaContainer,"none"),display(initialScreen,"none"),display(actionButtons,"none"),display(simpleRoom,"flex"),setValue("joinMeetingSimple",smartVideo.msgStore.startAvatar),setPlaceholder("nameSimple",smartVideo.msgStore.enterYourName),setLocale("invalidSimpleName",smartVideo.msgStore.enterYourName);var e=document.querySelector("#simpleForm");e.addEventListener("submit",(function(t){t.preventDefault(),t.stopPropagation(),e.classList.add("was-validated");var n=function(e){var t=!0;return e.forEach((e=>{let n=!e.parentElement.parentElement.classList.contains("d-none"),i=!e.validity.tooShort&&!e.validity.valueMissing;n&&!i&&(t=!1)})),t}(document.querySelectorAll(".simple-fields"));if(n){display(simpleRoom,"none"),display(videoMediaContainer,"flex"),display(actionButtons,"flex"),isRecording&&!DetectRTC.isMobileDevice&&display(recordingButton,!0);let e=document.getElementById("nameSimple").value;peer_name=e,DetectRTC.isMobileDevice&&(canvasElement.style.objectFit="cover",mediaElement.style.objectFit="cover",isOffset&&(canvasElement.style.objectPosition="65% 0%",mediaElement.style.objectPosition="65% 0%")),saveLog("start"),resizeVideoMedia(),isAudio||1!==videoAiLayout||(toggleChatPin(),DetectRTC.isMobileDevice||toggleChat()),startMeetingTimer(3e4+meetingTimerLength),isAudio?(1===videoAiLayout&&(chatRoom.style.width="50vh",chatRoom.style.height="100%",chatRoom.style.marginRight=0,chatRoom.style.paddingLeft=0,DetectRTC.isMobileDevice?(chatRoom.style.marginTop="5px",contentMediaContainer.style.width="100%"):contentMediaContainer.style.width="calc(100% - 50vh)",contentMediaContainer.style.padding="5px",display(contentMediaContainer,!0)),toggleChat(),display(videoMediaContainer,"none"),display(chatButton,"none"),display(languageButton,"none"),display(chatCloseButton,"none"),greetVoice()):createNewSession()}}),!1)}()}function setNotify(e,t,n,i=3e3,o=!0,r=!0){let a=n.split("|"),s=a[1]||"center";r&&notyf&&notyf.dismissAll(),notyf=new Notyf({duration:i,position:{x:s,y:a[0]},types:[{type:"warning",background:"var(--action-audio)",icon:{className:"material-icons",tagName:"i",text:"warning"},dismissible:o},{type:"info",background:"var(--blue-bg)",dismissible:o},{type:"error",background:"indianred",dismissible:o}]});notyf.open({type:e,message:t})}async function postData(e="",t={}){return await fetch(e,{method:"POST",mode:"cors",cache:"no-cache",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)})}function exit(){closeConnectionHandler(),saveLog("end"),exitMeeting?2==exitMeeting?location.reload():location.href=exitMeeting:window.location="./"}var modal;function toggleModal(e){e?modal.classList.add("show-modal"):modal.classList.remove("show-modal"),modal||(modal=document.getElementsByClassName("modal").classList.remove("show-modal"))}function actionModal(e,t,n,i,o,r){modal=document.getElementById("actionModal"),toggleModal(!0),document.getElementById("actionModalTitle").innerHTML=e,document.getElementById("actionModalBody").innerHTML=t,document.getElementById("actionModalOkButton").innerHTML=n,document.getElementById("actionModalDismissButton").innerHTML=o,display(actionModalBody,t?"flex":"none"),display(actionModalOkButton,n?"flex":"none"),display(actionModalDismissButton,o?"flex":"none"),actionModalDismissButton.onclick=()=>{toggleModal(!1),r&&r()},actionModalOkButton.onclick=()=>{toggleModal(!1),i&&i()}}function exitRoom(){actionModal(smartVideo.msgStore.sureLeaveMeeting,"",smartVideo.msgStore.yes,(function(){window.onbeforeunload=null,exit()}),smartVideo.msgStore.no)}addEventListener("beforeunload",(e=>{if(window.onbeforeunload)return wantExit()})),onbeforeunload=e=>wantExit(),exitButton.onclick=()=>{exitRoom()},stopButton.onclick=()=>{interrupt()},recordingButton.onclick=()=>{startRecording()},stopRecordingButton.onclick=()=>{stopRecording()};let showLanguages=!1;languageButton.onclick=()=>{showLanguages?(languageButton.classList.remove("activeControl"),display(languageMenuBar,!1)):(languageButton.classList.add("activeControl"),display(languageMenuBar,!0)),showLanguages=!showLanguages};const selectVoices=document.getElementById("listvoices");function wantExit(){exit()}function display(e,t){e.style.display=t,!1===t&&e.classList.add("d-none"),!0===t&&e.classList.remove("d-none")}function showTranscribeMessage(e,t=!0){isSubtitle&&(isAudio||(t&&(e=e.replace(/(<([^>]+)>)/gi,"")),display(translateMessage,!0),clearTimeout(transcriptTimer),transcriptTimer=0,translateMessage.innerHTML=e,timeoutLength||(timeoutLength=4e3),transcriptTimer=setTimeout((()=>{display(translateMessage,!1),translateMessage.innerHTML=""}),timeoutLength)))}function saveLog(e){var t=(new Date).toISOString();if("join"==e||"start"==e)var n="OS: "+DetectRTC.osName+" "+DetectRTC.osVersion+"<br/>Browser: "+DetectRTC.browser.name+" "+DetectRTC.browser.version+"<br/>Mobile: "+DetectRTC.isMobileDevice;else n="";postData("server/script.php",{type:"addlog",roomId:room_id,message:e,agent:peer_name,agentId:agentId,datetime:t,ua:n,attendee:videoAvatarName}).then((e=>{}))}selectVoices.onchange=async e=>{videoVoice=e.target.value,liveStorage.setItem("peer_name",peer_name+videoVoice),await closeConnectionHandler(),await startNewSession(),languageButton.onclick()},window.FontAwesomeKitConfig={asyncLoading:{enabled:!1},autoA11y:{enabled:!0},baseUrl:"https://ka-f.fontawesome.com",baseUrlKit:"https://kit.fontawesome.com",detectConflictsUntil:null,iconUploads:{},id:39495983,license:"free",method:"css",minify:{enabled:!0},token:"d2f1016e6f",v4FontFaceShim:{enabled:!0},v4shim:{enabled:!0},v5FontFaceShim:{enabled:!1},version:"6.0.0"},function(e){"function"==typeof define&&define.amd?define("kit-loader",e):e()}((function(){function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function i(e){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?n(Object(o),!0).forEach((function(n){t(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}return n}}(e,t)||function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function a(e,t){var n=t&&t.addOn||"",i=t&&t.baseFilename||e.license+n,o=t&&t.minify?".min":"",r=t&&t.fileSuffix||e.method,a=t&&t.subdir||e.method;return e.baseUrl+"/releases/"+("latest"===e.version?"latest":"v".concat(e.version))+"/"+a+"/"+i+o+"."+r}function s(e){return e.baseUrlKit+"/"+e.token+"/"+e.id+"/kit-upload.css"}function c(e,t){var n=t||["fa"],i="."+Array.prototype.join.call(n,",."),o=e.querySelectorAll(i);Array.prototype.forEach.call(o,(function(t){var n=t.getAttribute("title");t.setAttribute("aria-hidden","true");var i=!t.nextElementSibling||!t.nextElementSibling.classList.contains("sr-only");if(n&&i){var o=e.createElement("span");o.innerHTML=n,o.classList.add("sr-only"),t.parentNode.insertBefore(o,t.nextSibling)}}))}var d,l=function(){},u="undefined"!=typeof global&&void 0!==global.process&&"function"==typeof global.process.emit,m="undefined"==typeof setImmediate?setTimeout:setImmediate,p=[];function g(){for(var e=0;e<p.length;e++)p[e][0](p[e][1]);p=[],d=!1}function f(e,t){p.push([e,t]),d||(d=!0,m(g,0))}function h(e){var t=e.owner,n=t._state,i=t._data,o=e[n],r=e.then;if("function"==typeof o){n="fulfilled";try{i=o(i)}catch(e){w(r,e)}}v(r,i)||("fulfilled"===n&&y(r,i),"rejected"===n&&w(r,i))}function v(t,n){var i;try{if(t===n)throw new TypeError("A promises callback cannot return that same promise.");if(n&&("function"==typeof n||"object"===e(n))){var o=n.then;if("function"==typeof o)return o.call(n,(function(e){i||(i=!0,n===e?S(t,e):y(t,e))}),(function(e){i||(i=!0,w(t,e))})),!0}}catch(e){return i||w(t,e),!0}return!1}function y(e,t){e!==t&&v(e,t)||S(e,t)}function S(e,t){"pending"===e._state&&(e._state="settled",e._data=t,f(M,e))}function w(e,t){"pending"===e._state&&(e._state="settled",e._data=t,f(A,e))}function b(e){e._then=e._then.forEach(h)}function M(e){e._state="fulfilled",b(e)}function A(e){e._state="rejected",b(e),!e._handled&&u&&global.process.emit("unhandledRejection",e._data,e)}function C(e){global.process.emit("rejectionHandled",e)}function k(e){if("function"!=typeof e)throw new TypeError("Promise resolver "+e+" is not a function");if(this instanceof k==0)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._then=[],function(e,t){function n(e){w(t,e)}try{e((function(e){y(t,e)}),n)}catch(e){n(e)}}(e,this)}k.prototype={constructor:k,_state:"pending",_then:null,_data:void 0,_handled:!1,then:function(e,t){var n={owner:this,then:new this.constructor(l),fulfilled:e,rejected:t};return!t&&!e||this._handled||(this._handled=!0,"rejected"===this._state&&u&&f(C,this)),"fulfilled"===this._state||"rejected"===this._state?f(h,n):this._then.push(n),n.then},catch:function(e){return this.then(null,e)}},k.all=function(e){if(!Array.isArray(e))throw new TypeError("You must pass an array to Promise.all().");return new k((function(t,n){var i=[],o=0;function r(e){return o++,function(n){i[e]=n,--o||t(i)}}for(var a,s=0;s<e.length;s++)(a=e[s])&&"function"==typeof a.then?a.then(r(s),n):i[s]=a;o||t(i)}))},k.race=function(e){if(!Array.isArray(e))throw new TypeError("You must pass an array to Promise.race().");return new k((function(t,n){for(var i,o=0;o<e.length;o++)(i=e[o])&&"function"==typeof i.then?i.then(t,n):t(i)}))},k.resolve=function(t){return t&&"object"===e(t)&&t.constructor===k?t:new k((function(e){e(t)}))},k.reject=function(e){return new k((function(t,n){n(e)}))};var _="function"==typeof Promise?Promise:k;function T(e,t){var n=t.fetch,i=t.XMLHttpRequest,o=t.token,r=e;return"URLSearchParams"in window?(r=new URL(e)).searchParams.set("token",o):r=r+"?token="+encodeURIComponent(o),r=r.toString(),new _((function(e,t){if("function"==typeof n)n(r,{mode:"cors",cache:"default"}).then((function(e){if(e.ok)return e.text();throw new Error("")})).then((function(t){e(t)})).catch(t);else if("function"==typeof i){var o=new i;o.addEventListener("loadend",(function(){this.responseText?e(this.responseText):t(new Error(""))})),["abort","error","timeout"].map((function(e){o.addEventListener(e,(function(){t(new Error(""))}))})),o.open("GET",r),o.send()}else t(new Error(""))}))}function x(e,t,n){var i=e;return[[/(url\("?)\.\.\/\.\.\/\.\./g,function(e,n){return"".concat(n).concat(t)}],[/(url\("?)\.\.\/webfonts/g,function(e,i){return"".concat(i).concat(t,"/releases/v").concat(n,"/webfonts")}],[/(url\("?)https:\/\/kit-free([^.])*\.fontawesome\.com/g,function(e,n){return"".concat(n).concat(t)}]].forEach((function(e){var t=o(e,2),n=t[0],r=t[1];i=i.replace(n,r)})),i}function R(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},o=t.document||o,r=c.bind(c,o,["fa","fab","fas","far","fal","fad","fak"]),d=Object.keys(e.iconUploads||{}).length>0;e.autoA11y.enabled&&n(r);var l=[{id:"fa-main",addOn:void 0}];e.v4shim&&e.v4shim.enabled&&l.push({id:"fa-v4-shims",addOn:"-v4-shims"}),e.v5FontFaceShim&&e.v5FontFaceShim.enabled&&l.push({id:"fa-v5-font-face",addOn:"-v5-font-face"}),e.v4FontFaceShim&&e.v4FontFaceShim.enabled&&l.push({id:"fa-v4-font-face",addOn:"-v4-font-face"}),d&&l.push({id:"fa-kit-upload",customCss:!0});var u=l.map((function(n){return new _((function(o,r){T(n.customCss?s(e):a(e,{addOn:n.addOn,minify:e.minify.enabled}),t).then((function(r){o(E(r,i(i({},t),{},{baseUrl:e.baseUrl,version:e.version,id:n.id,contentFilter:function(e,t){return x(e,t.baseUrl,t.version)}})))})).catch(r)}))}));return _.all(u)}function E(e,t){var n=t.contentFilter||function(e,t){return e},i=document.createElement("style"),o=document.createTextNode(n(e,t));return i.appendChild(o),i.media="all",t.id&&i.setAttribute("id",t.id),t&&t.detectingConflicts&&t.detectionIgnoreAttr&&i.setAttributeNode(document.createAttribute(t.detectionIgnoreAttr)),i}function B(e,t){t.autoA11y=e.autoA11y.enabled,"pro"===e.license&&(t.autoFetchSvg=!0,t.fetchSvgFrom=e.baseUrl+"/releases/"+("latest"===e.version?"latest":"v".concat(e.version))+"/svgs",t.fetchUploadedSvgFrom=e.uploadsUrl);var n=[];return e.v4shim.enabled&&n.push(new _((function(n,o){T(a(e,{addOn:"-v4-shims",minify:e.minify.enabled}),t).then((function(e){n(O(e,i(i({},t),{},{id:"fa-v4-shims"})))})).catch(o)}))),n.push(new _((function(n,o){T(a(e,{minify:e.minify.enabled}),t).then((function(e){var o=O(e,i(i({},t),{},{id:"fa-main"}));n(function(e,t){var n=t&&void 0!==t.autoFetchSvg?t.autoFetchSvg:void 0,i=t&&void 0!==t.autoA11y?t.autoA11y:void 0;return void 0!==i&&e.setAttribute("data-auto-a11y",i?"true":"false"),n&&(e.setAttributeNode(document.createAttribute("data-auto-fetch-svg")),e.setAttribute("data-fetch-svg-from",t.fetchSvgFrom),e.setAttribute("data-fetch-uploaded-svg-from",t.fetchUploadedSvgFrom)),e}(o,t))})).catch(o)}))),_.all(n)}function O(e,t){var n=document.createElement("SCRIPT"),i=document.createTextNode(e);return n.appendChild(i),n.referrerPolicy="strict-origin",t.id&&n.setAttribute("id",t.id),t&&t.detectingConflicts&&t.detectionIgnoreAttr&&n.setAttributeNode(document.createAttribute(t.detectionIgnoreAttr)),n}function L(e){var t,n=[],i=document,o=(i.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(i.readyState);o||i.addEventListener("DOMContentLoaded",t=function(){for(i.removeEventListener("DOMContentLoaded",t),o=1;t=n.shift();)t()}),o?setTimeout(e,0):n.push(e)}function D(e){"undefined"!=typeof MutationObserver&&new MutationObserver(e).observe(document,{childList:!0,subtree:!0})}try{if(window.FontAwesomeKitConfig){var I=window.FontAwesomeKitConfig,V={detectingConflicts:I.detectConflictsUntil&&new Date<=new Date(I.detectConflictsUntil),detectionIgnoreAttr:"data-fa-detection-ignore",fetch:window.fetch,token:I.token,XMLHttpRequest:window.XMLHttpRequest,document:document},N=document.currentScript,P=N?N.parentElement:document.head;(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"js"===e.method?B(e,t):"css"===e.method?R(e,t,(function(e){L(e),D(e)})):void 0})(I,V).then((function(e){e.map((function(e){try{P.insertBefore(e,N?N.nextSibling:null)}catch(t){P.appendChild(e)}})),V.detectingConflicts&&N&&L((function(){N.setAttributeNode(document.createAttribute(V.detectionIgnoreAttr));var e=function(e,t){var n=document.createElement("script");return t&&t.detectionIgnoreAttr&&n.setAttributeNode(document.createAttribute(t.detectionIgnoreAttr)),n.src=a(e,{baseFilename:"conflict-detection",fileSuffix:"js",subdir:"js",minify:e.minify.enabled}),n}(I,V);document.body.appendChild(e)}))})).catch((function(e){console.error("".concat("Font Awesome Kit:"," ").concat(e))}))}}catch(e){console.error("".concat("Font Awesome Kit:"," ").concat(e))}}));let isChatOpen=!1,isChatPinned=!1,chatMessages=[],leftMsgAvatar=null,rightMsgAvatar=null;function toggleChatPin(){if(DetectRTC.isMobileDevice&&(!videoAiLayout||0==videoAiLayout))return!1;isChatPinned?(1===videoAiLayout&&DetectRTC.isMobileDevice?(videoMediaContainer.style.top="8px",videoMediaContainer.style.right="10px",videoMediaContainer.style.width="25vh",videoMediaContainer.style.height="25vh",display(contentMediaContainer,!0)):(chatRoom.style.width="65%",chatRoom.style.marginRight="auto",videoMediaContainer.style.top=0,videoMediaContainer.style.right=null,videoMediaContainer.style.width="100%",videoMediaContainer.style.height="100%",display(contentMediaContainer,!1)),isChatPinned=!1,isLegacyAvatar||(canvasElement.style.setProperty("object-fit","","important"),mediaElement.style.setProperty("object-fit","","important"))):(1===videoAiLayout?(chatRoom.style.width="50vh",chatRoom.style.marginRight=0,chatRoom.style.paddingLeft=0,chatRoom.style.marginTop="37vh",videoMediaContainer.style.top="8px",videoMediaContainer.style.right="10px",DetectRTC.isMobileDevice?(videoMediaContainer.style.width="25vh",videoMediaContainer.style.height="25vh",chatRoom.style.marginTop="27vh",contentMediaContainer.style.width="100%"):(videoMediaContainer.style.width="49vh",videoMediaContainer.style.height="35vh",chatRoom.style.marginTop="37vh",contentMediaContainer.style.width="calc(100% - 50vh)"),contentMediaContainer.style.padding="5px",display(contentMediaContainer,!0),isLegacyAvatar&&(canvasElement.style.setProperty("object-fit","contain","important"),mediaElement.style.setProperty("object-fit","contain","important"))):(chatRoom.style.width="35%",chatRoom.style.marginRight=0,videoMediaContainer.style.top=0,videoMediaContainer.style.width="65%",videoMediaContainer.style.height="100%"),isChatPinned=!0,isLegacyAvatar||(canvasElement.style.setProperty("object-fit","cover","important"),mediaElement.style.setProperty("object-fit","cover","important"))),resizeVideoMedia()}function toggleChat(){let e=document.getElementById("chatRoom");0==isChatOpen?(chatButton.classList.add("activeControl"),e.classList.remove("d-none"),isChatOpen=!0,chatHistory.scrollTop+=5e3):(isChatPinned&&toggleChatPin(),chatButton.classList.remove("activeControl"),e.classList.add("d-none"),isChatOpen=!1)}function cleanMessage(){chatMessage.value="",chatMessage.style.height="40px"}async function sendVideoAi(e,t){let n;interrupt(),chatSpeechStartButton.classList.remove("activeControl"),speechRecognition&&startSpeech(!1),canUnmute=!1,t||(setMsgAvatar("right","ChatGPT"),appendMessage("right",rightMsgAvatar,peer_name,peer_id,e,videoAvatarName,"chatgpt",!0),showTranscribeMessage(peer_name+": "+e,!0)),cleanMessage(),n=videoAiAssistant?{type:"sendassistant",message:e,assistantId:videoAiAssistant,oa:oa,oamodel:oamodel}:{type:"sendopenai",message:e,context:chatContext,system:videoAiSystem,tools:videoAiTools,is_context:isContext,oa:oa,oamodel:oamodel},postData("server/script.php",n).then((e=>{e.text().then((function(e){if(e)if(500===(e=JSON.parse(e)).status)e.text?(updateStatus("error",e.text),saveLog(e.text)):(updateStatus("error",smartVideo.msgStore.errorOpenAI),saveLog(smartVideo.msgStore.errorOpenAI)),saveLog("failed"),console.error("Server error");else if(200===e.status){e.exit&&(setMsgAvatar("left",videoAvatarName),appendMessage("left",leftMsgAvatar,videoAvatarName,"chatgpt",smartVideo.msgStore.profanityWarning,peer_id,peer_name,!0),updateStatus("error",smartVideo.msgStore.profanityWarning),setTimeout((()=>{exit()}),1500));let t=e.text;t=t.split("|"),talkArray=t[0].split("~"),chatContext=e.context,e.background&&(1===videoAiLayout?document.body.style.setProperty("background",'url("'+e.background+'") center / cover no-repeat',"important"):(videoBackground=e.background,renderCanvas())),e.url&&window.open(e.url),e.embedUrl&&(stopSpeech=!0,document.getElementById("embedUrl").src=e.embedUrl),e.srcdoc&&(stopSpeech=!0,document.getElementById("embedUrl").srcdoc=e.srcdoc),talkHandler(talkArray[0]),setMsgAvatar("left",videoAvatarName),appendMessage("left",leftMsgAvatar,videoAvatarName,"chatgpt",t[0],peer_id,peer_name,!0),t[1]&&appendMessage("left",leftMsgAvatar,videoAvatarName,"chatgpt",t[1],peer_id,peer_name,!0),cleanMessage()}else console.log(e)}))}))}function sendMessage(){let e=formatMsg(chatMessage.value.trim());if(!e)return cleanMessage();sendVideoAi(e,!0),setMsgAvatar("right","Me"),appendMessage("right",rightMsgAvatar,peer_name,peer_id,e,"chatgpt","chatgpt",!0),showTranscribeMessage(peer_name+": "+e,!0),cleanMessage()}function genAvatarSvg(e,t,n){if(n)return"img/avatars/"+n;{const n=e.charCodeAt(0),i=e.charCodeAt(1)||n,o=Math.pow(n,7)%200,r=Math.pow(i,7)%200,a=`rgb(${o}, ${r}, ${(o+r)%200})`,s="#ffffff";let c=e.split(" ");c=c[1]?c[0].substring(0,1).toUpperCase()+c[1].substring(0,1).toUpperCase():e.substring(0,2).toUpperCase();return"data:image/svg+xml,"+`\n        <svg xmlns="http://www.w3.org/2000/svg" \n        xmlns:xlink="http://www.w3.org/1999/xlink" \n        width="${t}px" \n        height="${t}px" \n        viewBox="0 0 ${t} ${t}" \n        version="1.1">\n            <circle \n                fill="${a}" \n                width="${t}" \n                height="${t}" \n                cx="${t/2}" \n                cy="${t/2}" \n                r="${t/2}"\n            />\n            <text \n                x="50%" \n                y="50%" \n                font-family="-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Fira Sans, Droid Sans, Helvetica Neue, sans-serif"\n                alignment-baseline="middle" \n                text-anchor="middle" \n                font-size="${Math.round(.4*t)}" \n                font-weight="normal" \n                dy=".1em" \n                dominant-baseline="middle" \n                fill="${s}">${c}\n            </text>\n        </svg>`.replace(/#/g,"%23").replace(/"/g,"'").replace(/&/g,"&amp;")}}function getTimeNow(){const e=new Date;return String(e.getHours()).padStart(2,"0")+":"+String(e.getMinutes()).padStart(2,"0")}function setMsgAvatar(e,t,n){let i=genAvatarSvg(t,32,n);"left"===e?leftMsgAvatar=i:rightMsgAvatar=i}function appendMessage(e,t,n,i,o,r,a,s,c){const d=o,l=c||getTimeNow();var u="",m="";if("right"===e){var p=`<small class="message-data-time">${smartVideo.msgStore.me}, ${l}</small>`;u="<br><br><br><br>",m="float-right pt-3"}else{p=` <img src="${t}" alt="${n}">\n        <small class="message-data-time">${n+", "+l}</small>`}let g=d,f=`<li class="clearfix">\n                        <div class="message-data ${m}">\n                            ${p}\n                        </div>${u}\n                        <div class="message ${"right"==e?"other":"my"}-message float-${e}">${g}</div>\n                    </li>`;if(chatBoard.insertAdjacentHTML("beforeend",f),chatHistory.scrollTop+=500,s){collectMessages(i,n,r,a,d,l),g=g.replace(/(<([^>]+)>)/gi,"");postData("server/script.php",{type:"addchat",roomId:room_id,message:g,from:n,to:a,agentId:agentId,datetime:l,agentName:peer_name}).then((e=>{}))}}function formatMsg(e){const t=e;if(0!=t.trim().length)return isHtml(t)?sanitizeHtml(t):isValidHttpURL(t)?isImageURL(t)?'<img src="'+t+'" alt="img" width="180" height="auto"/>':isImageURL(t)?getImage(t):getLink(t):getLineBreaks(t)>1||getLineBreaks(t)>1?getPre(t):t}function sanitizeHtml(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;","/":"&#x2F;"};return e.replace(/[&<>"'/]/g,(e=>t[e]))}function isHtml(e){var t=document.createElement("div");t.innerHTML=e;for(var n=t.childNodes,i=n.length;i--;)if(1==n[i].nodeType)return!0;return!1}function isValidHttpURL(e){return new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)}function isImageURL(e){return null!=e.match(/\.(jpeg|jpg|gif|png|tiff|bmp)$/)}function getImage(e){const t=e,n=document.createElement("div"),i=document.createElement("img");return i.setAttribute("src",t),i.setAttribute("width","200px"),i.setAttribute("height","auto"),n.appendChild(i),n.firstChild.outerHTML}function getLink(e){const t=e,n=document.createElement("a"),i=document.createElement("div"),o=document.createTextNode(t);return n.setAttribute("href",t),n.setAttribute("target","_blank"),n.appendChild(o),i.appendChild(n),i.firstChild.outerHTML}function getPre(e){const t=e,n=document.createElement("pre"),i=document.createElement("div");return n.textContent=t,i.appendChild(n),i.firstChild.outerHTML}function getLineBreaks(e){return(e.match(/\n/g)||[]).length}function collectMessages(e,t,n,i,o,r){chatMessages.push({fromId:e,fromName:t,toId:n,toName:i,msg:o,time:r})}chatButton.onclick=()=>{toggleChatPin(),toggleChat()},chatSendButton.onclick=()=>{sendMessage()},chatMessage.onkeyup=e=>{13!==e.keyCode||!DetectRTC.isMobileDevice&&e.shiftKey||(e.preventDefault(),chatSendButton.click())},chatCloseButton.onclick=()=>{toggleChat()};let fileNameRecording,_isRecording=!1,_isStoppableRecording=!0,mediaRecorder=null,recScreenStream=null,_isPausedRecording=null,recordedBlobs=[];function getSupportedMimeTypes(){return["video/webm;codecs=vp9,opus","video/webm;codecs=vp8,opus","video/webm;codecs=h264,opus","video/mp4;codecs=h264,aac","video/mp4"].filter((e=>MediaRecorder.isTypeSupported(e)))}async function startRecording(){try{const e=new Date;let t=e.toISOString().split("T")[0];t=t.replaceAll("-","_");let n=e.toTimeString().split(" ")[0];n=n.replaceAll(":","_"),fileNameRecording=t+"_"+n,recordedBlobs=[];let i,o,r=getSupportedMimeTypes();r={mimeType:r[0]};try{i=await navigator.mediaDevices.getUserMedia({video:!1,audio:{echoCancellation:!1,noiseSuppression:!1}}),o=await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"monitor"},audio:{channelCount:2,echoCancellation:!1,noiseSuppression:!1}})}catch(e){return console.error("Exception while creating MediaRecorder: ",e),void setNotify("error",smartVideo.msgStore.errorStreamRecord+" "+e,"top")}const a=new AudioContext,s=a.createMediaStreamDestination();i.getAudioTracks().length>0&&a.createMediaStreamSource(i).connect(s),o.getAudioTracks().length>0&&a.createMediaStreamSource(o).connect(s);let c=s.stream.getTracks();c=c.concat(i.getVideoTracks()).concat(o.getVideoTracks());let d=new MediaStream(c);d.addEventListener("ended",(function(){handleMediaRecorderStop()}),!1),d.addEventListener("inactive",(function(){handleMediaRecorderStop()}),!1),d.getTracks().forEach((function(e){e.addEventListener("ended",(function(){handleMediaRecorderStop()}),!1),e.addEventListener("inactive",(function(){handleMediaRecorderStop()}),!1)}));let l=new MediaRecorder(d,r);recScreenStream=d,mediaRecorder=l,_isRecording=!0,handleMediaRecorder(),_isStoppableRecording=!1,display(recordingButton,!1),display(stopRecordingButton,!0)}catch(e){return void setNotify("error",smartVideo.msgStore.errorStreamRecord+" "+e,"top")}}function handleMediaRecorder(){mediaRecorder.start(4e3),mediaRecorder.addEventListener("start",handleMediaRecorderStart),mediaRecorder.addEventListener("dataavailable",handleMediaRecorderData),mediaRecorder.addEventListener("stop",handleMediaRecorderStop)}function handleMediaRecorderStart(e){}function handleMediaRecorderData(e){e.data&&e.data.size>0&&(recordedBlobs.push(e.data),recFileName="record_"+room_id+"_"+`${fileNameRecording}.webm`,saveRecording(e.data,recFileName))}function saveRecording(e,t){const n=e,i=new FileReader;i.readAsArrayBuffer(n),i.onload=async e=>{const n=e.target.result,i=1e6,o=e.target.result.byteLength/i;for(let e=0;e<o+1;e++){let o=n.slice(e*i,(e+1)*i);await fetch("server/upload.php?filename="+t,{method:"POST",headers:{"content-type":"application/octet-stream","content-length":o.length},body:o})}}}function handleMediaRecorderStop(e){try{stopRecording()}catch(e){console.warn("Recording save failed",e)}}function fileSetRecording(){if(recordedBlobs.length){var e=recordedBlobs[0].type.includes("mp4")?"mp4":"webm";new Blob(recordedBlobs,{type:"video/"+e})}else e=mediaRecorder.getBlob().type.includes("mp4")?"mp4":"webm";recFileName="record_"+room_id+"_"+`${fileNameRecording}.`+e,postData("server/script.php",{type:"addrecording",roomId:room_id,filename:recFileName,agentId:agentId}),isSendSaveRecording=!0}function pauseRecording(){_isRecording=!1,_isPausedRecording=!0,mediaRecorder.pause()}function resumeRecording(){_isRecording=!0,_isPausedRecording=!1,mediaRecorder.resume()}function stopRecording(e){(_isRecording||_isPausedRecording)&&(smartVideo.config.serverSide&&smartVideo.config.serverSide.videoLogs&&saveLog("stop recording"),e||(_isRecording=!1),recScreenStream?(mediaRecorder.stop(),recScreenStream&&recScreenStream.getTracks().forEach((e=>{"video"===e.kind&&e.stop()})),fileSetRecording()):mediaRecorder.stopRecording((function(){fileSetRecording()})),display(recordingButton,!0),display(stopRecordingButton,!1),_isStoppableRecording=!1)}let customRatio=!0,ratios=["0:0","4:3","16:9","1:1","1:2"],aspect=2,ratio=getAspectRatio();function getAspectRatio(){customRatio=0==aspect;var e=ratios[aspect].split(":");return e[1]/e[0]}function setAspectRatio(e){aspect=e,ratio=getAspectRatio(),resizeVideoMedia()}function Area(e,t,n,i,o=10){ratio=customRatio?.75:ratio;let r=0,a=0,s=e*ratio+2*o;for(;r<t;)a+e>n&&(a=0,s=s+e*ratio+2*o),a=a+e+2*o,r++;return!(s>i)&&e}function resizeVideoMedia(){let e=document.getElementById("videoMediaContainer"),t=document.getElementsByClassName("videoContainerElement"),n=e.offsetWidth-6,i=e.offsetHeight-6,o=0,r=4*n;1==e.childElementCount&&(n-=r);let a=1;for(;a<5e3;){if(!1===Area(a,t.length,n,i,3)){o=a-1;break}a++}o-=6,setWidth(e,t,o,r,3,i)}function setWidth(e,t,n,i,o,r){ratio=customRatio?.68:ratio;let a=1==e.childElementCount;for(let e=0;e<t.length;e++)if(t[e].style.width=n+"px",t[e].style.margin=o+"px",t[e].style.height=n*ratio+"px",a){t[e].style.width=i+"px",t[e].style.height=i*ratio+"px",t[e].style.height.substring(0,t[e].style.height.length-2)>=r&&(t[e].style.height=r-2+"px")}}window.addEventListener("load",(function(e){resizeVideoMedia(),window.onresize=resizeVideoMedia}),!1);var CryptoJS=CryptoJS||function(e,t){var n={},i=n.lib={},o=function(){},r=i.Base={extend:function(e){o.prototype=this;var t=new o;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=i.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes;if(e=e.sigBytes,this.clamp(),i%4)for(var o=0;o<e;o++)t[i+o>>>2]|=(n[o>>>2]>>>24-o%4*8&255)<<24-(i+o)%4*8;else if(65535<n.length)for(o=0;o<e;o+=4)t[i+o>>>2]=n[o>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],i=0;i<t;i+=4)n.push(4294967296*e.random()|0);return new a.init(n,t)}}),s=n.enc={},c=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new a.init(n,t/2)}},d=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++)n.push(String.fromCharCode(t[i>>>2]>>>24-i%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new a.init(n,t)}},l=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},u=i.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,i=n.words,o=n.sigBytes,r=this.blockSize,s=o/(4*r);if(t=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*r,o=e.min(4*t,o),t){for(var c=0;c<t;c+=r)this._doProcessBlock(i,c);c=i.splice(0,t),n.sigBytes-=o}return new a.init(c,o)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});i.Hasher=u.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new m.HMAC.init(e,n).finalize(t)}}});var m=n.algo={};return n}(Math);!function(){var e=CryptoJS,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,i=this._map;e.clamp(),e=[];for(var o=0;o<n;o+=3)for(var r=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,a=0;4>a&&o+.75*a<n;a++)e.push(i.charAt(r>>>6*(3-a)&63));if(t=i.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var n=e.length,i=this._map;(o=i.charAt(64))&&(-1!=(o=e.indexOf(o))&&(n=o));for(var o=[],r=0,a=0;a<n;a++)if(a%4){var s=i.indexOf(e.charAt(a-1))<<a%4*2,c=i.indexOf(e.charAt(a))>>>6-a%4*2;o[r>>>2]|=(s|c)<<24-r%4*8,r++}return t.create(o,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){function t(e,t,n,i,o,r,a){return((e=e+(t&n|~t&i)+o+a)<<r|e>>>32-r)+t}function n(e,t,n,i,o,r,a){return((e=e+(t&i|n&~i)+o+a)<<r|e>>>32-r)+t}function i(e,t,n,i,o,r,a){return((e=e+(t^n^i)+o+a)<<r|e>>>32-r)+t}function o(e,t,n,i,o,r,a){return((e=e+(n^(t|~i))+o+a)<<r|e>>>32-r)+t}for(var r=CryptoJS,a=(c=r.lib).WordArray,s=c.Hasher,c=r.algo,d=[],l=0;64>l;l++)d[l]=4294967296*e.abs(e.sin(l+1))|0;c=c.MD5=s.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,r){for(var a=0;16>a;a++){var s=e[c=r+a];e[c]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}a=this._hash.words;var c=e[r+0],l=(s=e[r+1],e[r+2]),u=e[r+3],m=e[r+4],p=e[r+5],g=e[r+6],f=e[r+7],h=e[r+8],v=e[r+9],y=e[r+10],S=e[r+11],w=e[r+12],b=e[r+13],M=e[r+14],A=e[r+15],C=t(C=a[0],T=a[1],_=a[2],k=a[3],c,7,d[0]),k=t(k,C,T,_,s,12,d[1]),_=t(_,k,C,T,l,17,d[2]),T=t(T,_,k,C,u,22,d[3]);C=t(C,T,_,k,m,7,d[4]),k=t(k,C,T,_,p,12,d[5]),_=t(_,k,C,T,g,17,d[6]),T=t(T,_,k,C,f,22,d[7]),C=t(C,T,_,k,h,7,d[8]),k=t(k,C,T,_,v,12,d[9]),_=t(_,k,C,T,y,17,d[10]),T=t(T,_,k,C,S,22,d[11]),C=t(C,T,_,k,w,7,d[12]),k=t(k,C,T,_,b,12,d[13]),_=t(_,k,C,T,M,17,d[14]),C=n(C,T=t(T,_,k,C,A,22,d[15]),_,k,s,5,d[16]),k=n(k,C,T,_,g,9,d[17]),_=n(_,k,C,T,S,14,d[18]),T=n(T,_,k,C,c,20,d[19]),C=n(C,T,_,k,p,5,d[20]),k=n(k,C,T,_,y,9,d[21]),_=n(_,k,C,T,A,14,d[22]),T=n(T,_,k,C,m,20,d[23]),C=n(C,T,_,k,v,5,d[24]),k=n(k,C,T,_,M,9,d[25]),_=n(_,k,C,T,u,14,d[26]),T=n(T,_,k,C,h,20,d[27]),C=n(C,T,_,k,b,5,d[28]),k=n(k,C,T,_,l,9,d[29]),_=n(_,k,C,T,f,14,d[30]),C=i(C,T=n(T,_,k,C,w,20,d[31]),_,k,p,4,d[32]),k=i(k,C,T,_,h,11,d[33]),_=i(_,k,C,T,S,16,d[34]),T=i(T,_,k,C,M,23,d[35]),C=i(C,T,_,k,s,4,d[36]),k=i(k,C,T,_,m,11,d[37]),_=i(_,k,C,T,f,16,d[38]),T=i(T,_,k,C,y,23,d[39]),C=i(C,T,_,k,b,4,d[40]),k=i(k,C,T,_,c,11,d[41]),_=i(_,k,C,T,u,16,d[42]),T=i(T,_,k,C,g,23,d[43]),C=i(C,T,_,k,v,4,d[44]),k=i(k,C,T,_,w,11,d[45]),_=i(_,k,C,T,A,16,d[46]),C=o(C,T=i(T,_,k,C,l,23,d[47]),_,k,c,6,d[48]),k=o(k,C,T,_,f,10,d[49]),_=o(_,k,C,T,M,15,d[50]),T=o(T,_,k,C,p,21,d[51]),C=o(C,T,_,k,w,6,d[52]),k=o(k,C,T,_,u,10,d[53]),_=o(_,k,C,T,y,15,d[54]),T=o(T,_,k,C,s,21,d[55]),C=o(C,T,_,k,h,6,d[56]),k=o(k,C,T,_,A,10,d[57]),_=o(_,k,C,T,g,15,d[58]),T=o(T,_,k,C,b,21,d[59]),C=o(C,T,_,k,m,6,d[60]),k=o(k,C,T,_,S,10,d[61]),_=o(_,k,C,T,l,15,d[62]),T=o(T,_,k,C,v,21,d[63]);a[0]=a[0]+C|0,a[1]=a[1]+T|0,a[2]=a[2]+_|0,a[3]=a[3]+k|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,o=8*t.sigBytes;n[o>>>5]|=128<<24-o%32;var r=e.floor(i/4294967296);for(n[15+(o+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),n[14+(o+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),t.sigBytes=4*(n.length+1),this._process(),n=(t=this._hash).words,i=0;4>i;i++)o=n[i],n[i]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8);return t},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),r.MD5=s._createHelper(c),r.HmacMD5=s._createHmacHelper(c)}(Math),function(){var e,t=CryptoJS,n=(e=t.lib).Base,i=e.WordArray,o=(e=t.algo).EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:e.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=(s=this.cfg).hasher.create(),o=i.create(),r=o.words,a=s.keySize,s=s.iterations;r.length<a;){c&&n.update(c);var c=n.update(e).finalize(t);n.reset();for(var d=1;d<s;d++)c=n.finalize(c),n.reset();o.concat(c)}return o.sigBytes=4*a,o}});t.EvpKDF=function(e,t,n){return o.create(n).compute(e,t)}}(),CryptoJS.lib.Cipher||function(e){var t=(p=CryptoJS).lib,n=t.Base,i=t.WordArray,o=t.BufferedBlockAlgorithm,r=p.enc.Base64,a=p.algo.EvpKDF,s=t.Cipher=o.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,n,i){return("string"==typeof n?g:m).encrypt(e,t,n,i)},decrypt:function(t,n,i){return("string"==typeof n?g:m).decrypt(e,t,n,i)}}}});t.StreamCipher=s.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=p.mode={},d=function(e,t,n){var i=this._iv;i?this._iv=undefined:i=this._prevBlock;for(var o=0;o<n;o++)e[t+o]^=i[o]},l=(t.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();l.Encryptor=l.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize;d.call(this,e,t,i),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+i)}}),l.Decryptor=l.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,o=e.slice(t,t+i);n.decryptBlock(e,t),d.call(this,e,t,i),this._prevBlock=o}}),c=c.CBC=l,l=(p.pad={}).Pkcs7={pad:function(e,t){for(var n,o=(n=(n=4*t)-e.sigBytes%n)<<24|n<<16|n<<8|n,r=[],a=0;a<n;a+=4)r.push(o);n=i.create(r,n),e.concat(n)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},t.BlockCipher=s.extend({cfg:s.cfg.extend({mode:c,padding:l}),reset:function(){s.reset.call(this);var e=(t=this.cfg).iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=t.createEncryptor;else n=t.createDecryptor,this._minBufferSize=1;this._mode=n.call(t,this,e&&e.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var u=t.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),m=(c=(p.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?i.create([1398893684,1701076831]).concat(e).concat(t):t).toString(r)},parse:function(e){var t=(e=r.parse(e)).words;if(1398893684==t[0]&&1701076831==t[1]){var n=i.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return u.create({ciphertext:e,salt:n})}},t.SerializableCipher=n.extend({cfg:n.extend({format:c}),encrypt:function(e,t,n,i){i=this.cfg.extend(i);var o=e.createEncryptor(n,i);return t=o.finalize(t),o=o.cfg,u.create({ciphertext:t,key:n,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:e.blockSize,formatter:i.format})},decrypt:function(e,t,n,i){return i=this.cfg.extend(i),t=this._parse(t,i.format),e.createDecryptor(n,i).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}})),p=(p.kdf={}).OpenSSL={execute:function(e,t,n,o){return o||(o=i.random(8)),e=a.create({keySize:t+n}).compute(e,o),n=i.create(e.words.slice(t),4*n),e.sigBytes=4*t,u.create({key:e,iv:n,salt:o})}},g=t.PasswordBasedCipher=m.extend({cfg:m.cfg.extend({kdf:p}),encrypt:function(e,t,n,i){return n=(i=this.cfg.extend(i)).kdf.execute(n,e.keySize,e.ivSize),i.iv=n.iv,(e=m.encrypt.call(this,e,t,n.key,i)).mixIn(n),e},decrypt:function(e,t,n,i){return i=this.cfg.extend(i),t=this._parse(t,i.format),n=i.kdf.execute(n,e.keySize,e.ivSize,t.salt),i.iv=n.iv,m.decrypt.call(this,e,t,n.key,i)}})}(),function(){for(var e=CryptoJS,t=e.lib.BlockCipher,n=e.algo,i=[],o=[],r=[],a=[],s=[],c=[],d=[],l=[],u=[],m=[],p=[],g=0;256>g;g++)p[g]=128>g?g<<1:g<<1^283;var f=0,h=0;for(g=0;256>g;g++){var v=(v=h^h<<1^h<<2^h<<3^h<<4)>>>8^255&v^99;i[f]=v,o[v]=f;var y=p[f],S=p[y],w=p[S],b=257*p[v]^16843008*v;r[f]=b<<24|b>>>8,a[f]=b<<16|b>>>16,s[f]=b<<8|b>>>24,c[f]=b,b=16843009*w^65537*S^257*y^16843008*f,d[v]=b<<24|b>>>8,l[v]=b<<16|b>>>16,u[v]=b<<8|b>>>24,m[v]=b,f?(f=y^p[p[p[w^y]]],h^=p[p[h]]):f=h=1}var M=[0,1,2,4,8,16,32,64,128,27,54];n=n.AES=t.extend({_doReset:function(){for(var e=(n=this._key).words,t=n.sigBytes/4,n=4*((this._nRounds=t+6)+1),o=this._keySchedule=[],r=0;r<n;r++)if(r<t)o[r]=e[r];else{var a=o[r-1];r%t?6<t&&4==r%t&&(a=i[a>>>24]<<24|i[a>>>16&255]<<16|i[a>>>8&255]<<8|i[255&a]):(a=i[(a=a<<8|a>>>24)>>>24]<<24|i[a>>>16&255]<<16|i[a>>>8&255]<<8|i[255&a],a^=M[r/t|0]<<24),o[r]=o[r-t]^a}for(e=this._invKeySchedule=[],t=0;t<n;t++)r=n-t,a=t%4?o[r]:o[r-4],e[t]=4>t||4>=r?a:d[i[a>>>24]]^l[i[a>>>16&255]]^u[i[a>>>8&255]]^m[i[255&a]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,r,a,s,c,i)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,d,l,u,m,o),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,i,o,r,a,s){for(var c=this._nRounds,d=e[t]^n[0],l=e[t+1]^n[1],u=e[t+2]^n[2],m=e[t+3]^n[3],p=4,g=1;g<c;g++){var f=i[d>>>24]^o[l>>>16&255]^r[u>>>8&255]^a[255&m]^n[p++],h=i[l>>>24]^o[u>>>16&255]^r[m>>>8&255]^a[255&d]^n[p++],v=i[u>>>24]^o[m>>>16&255]^r[d>>>8&255]^a[255&l]^n[p++];m=i[m>>>24]^o[d>>>16&255]^r[l>>>8&255]^a[255&u]^n[p++],d=f,l=h,u=v}f=(s[d>>>24]<<24|s[l>>>16&255]<<16|s[u>>>8&255]<<8|s[255&m])^n[p++],h=(s[l>>>24]<<24|s[u>>>16&255]<<16|s[m>>>8&255]<<8|s[255&d])^n[p++],v=(s[u>>>24]<<24|s[m>>>16&255]<<16|s[d>>>8&255]<<8|s[255&l])^n[p++],m=(s[m>>>24]<<24|s[d>>>16&255]<<16|s[l>>>8&255]<<8|s[255&u])^n[p++],e[t]=f,e[t+1]=h,e[t+2]=v,e[t+3]=m},keySize:8});e.AES=t._createHelper(n)}();let videoAvatar,videoVoice,videoAiTools,pageLanguage,videoGreetingText,videoAiAssistant,videoAiGender,hg,oa,elabs,oamodel,listvoices,videoAiLayout,videoAiSuggestions,datetime,duration,notyf,subscrInterval,audioSession,meetingTimer,inactivityTimeout,meetingTimerLength,isSubtitle,exitMeeting,videoAiEnabled=!1,videoAiInfo=null,videoAiQuality="medium",videoAvatarName="Monica",videoBackground="",videoAiSystem="You are a streaming avatar from LiveSmart Server Video, an industry-leading product that specializes in video communications. Audience will try to have a conversation with you, please try to answer the questions or respond to their comments naturally, and concisely. Please try your best to respond with short answers, and only answer the last question.",chatContext=[],isContext=!0,isAudio=!1,isOffset=!1,isRecording=!1,isLegacyAvatar=!1;const hrefUrl=new URL(window.location.href),mediaElement=document.querySelector("#mediaElement"),room_id=mediaElement.dataset.roomId;let agentId,recognition;const speechRecognition="SpeechRecognition"in window||"webkitSpeechRecognition"in window;var isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;let sessionToken=null,mediaStream=null,webSocket=null,room=null;const API_CONFIG={serverUrl:"https://api.heygen.com"};function postData(e="",t={}){return fetch(e,{method:"POST",mode:"cors",cache:"no-cache",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)})}function cleanAll(){display(videoMediaContainer,"none"),display(initialScreen,"none"),display(actionButtons,"none"),display(simpleRoom,"none")}isIOS&&(speechRecognition?(recognition=new(window.SpeechRecognition||window.webkitSpeechRecognition),recognition.continuous=!0,recognition.interimResults=!1,recognition.maxAlternatives=5,pageLanguage&&(recognition.lang=pageLanguage),recognition.addEventListener("start",(()=>{chatSpeechStartButton.classList.add("activeControl"),setTooltip("chatSpeechStartButton",smartVideo.msgStore.chatSpeechStop,"top")})),recognition.addEventListener("result",(e=>{let t=e.resultIndex,n=e.results[t][0].transcript;n&&sendVideoAi(n)})),recognition.addEventListener("error",(e=>{console.warn("Speech recognition error",e.error),setTimeout((()=>{canUnmute&&"no-speech"===e.error&&(chatSpeechStartButton.classList.add("activeControl"),speechRecognition&&startSpeech(!0))}),200)})),recognition.addEventListener("end",(()=>{chatSpeechStartButton.classList.remove("activeControl"),setTooltip("chatSpeechStartButton",smartVideo.msgStore.chatSpeechStart,"top")}))):(console.warn("This browser not supports webkitSpeechRecognition"),chatSpeechStartButton.classList.remove("activeControl"),setTooltip("chatSpeechStartButton",smartVideo.msgStore.chatSpeechStart,"top")));const smartVideo={msgStore:{},config:{},persistMsgStore:function(e){try{localStorage.setItem("msgStore",JSON.stringify(e)),smartVideo.msgStore=e}catch(e){}},setLanguage:function(e){fetch("locales/"+e+".json?v="+window.codeVersion).then((e=>e.json())).then((e=>{smartVideo.persistMsgStore(e),postData("server/script.php",{type:"getvideoai",roomid:room_id}).then((e=>{e.text().then((function(e){if(e){videoAiEnabled=!0;var t=JSON.parse(e);videoAvatar=t.video_ai_avatar,videoVoice=t.video_ai_voice,videoBackground=t.video_ai_background,videoAiQuality=t.video_ai_quality,videoAvatarName=t.video_ai_name;if(["default","Monica_inSleeveless _20220819","Kristin_public_2_20240108","Angela-inblackskirt-20220820","Kayla-incasualsuit-20220818","Anna_public_3_20240108","Anna_public_20240108","Briana_public_3_20240110","Justin_public_3_20240308","Lily_public_pro1_20230614","Wade_public_2_20240228","Tyler-incasualsuit-20220721","Tyler-inshirt-20220721","Tyler-insuit-20220721","Eric_public_pro2_20230608","Susan_public_2_20240328"].includes(videoAvatar)&&(isLegacyAvatar=!0),videoAiSystem=t.video_ai_system,videoAiTools=t.video_ai_tools,pageLanguage=t.language,videoGreetingText=t.ai_greeting_text,isContext=1==t.is_context,isSubtitle=1==t.is_subtitle,isRecording=1==t.is_recording,isAudio=1==t.is_audio,isOffset=1==t.is_offset,videoAiAssistant=t.video_ai_assistant,videoAiGender=t.video_ai_gender,videoAiLayout=t.video_ai_layout,videoAiSuggestions=t.video_ai_suggestions,duration=t.duration,exitMeeting=t.exit_meeting,datetime=t.datetime,inactivityTimeout=!!t.inactivity_timeout&&t.inactivity_timeout,inactivityTimeout&&(meetingTimerLength=1e3*inactivityTimeout),t.heygen_key&&(hg=btoa(t.heygen_key)),t.openai_key&&(oa=btoa(t.openai_key)),t.elevenlabs_key&&(elabs=btoa(t.elevenlabs_key)),oamodel=t.openai_model,agentId=t.tenant,isAudio){const e="css/contentaudio.css?v="+window.codeVersion;let t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e),document.getElementsByTagName("head")[0].appendChild(t)}if(1===videoAiLayout){let e="css/contentlayout.css?v="+window.codeVersion;isAudio&&(e="css/contentlayoutaudio.css?v="+window.codeVersion);let t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e),document.getElementsByTagName("head")[0].appendChild(t)}postData("server/script.php",{type:"checkpayment",agentId:agentId}).then((e=>{e.text().then((function(e){if("true"===e||Number.isInteger(parseInt(e))&&parseInt(e)>0){"true"!==e&&Number.isInteger(parseInt(e))&&(subscrInterval=parseInt(e),checkMinuteTimer(60)),postData("server/script.php",{type:"listvoices"}).then((e=>{e.text().then((function(e){let t=document.getElementById("listvoices");t.options[t.options.length]=new Option("-",""),listvoices=JSON.parse(e);let n=listvoices.data.voices;n.sort(((e,t)=>e.language>t.language?1:-1)),n.forEach((e=>{let n=" "+e.name;"unknown"==e.gender&&(n=""),"Edward"!==videoAvatarName&&"Justin"!==videoAvatarName&&"Wade"!==videoAvatarName&&"Tyler"!==videoAvatarName||(videoAiGender="male"),""===videoVoice&&(videoAiGender="female"),videoAvatar||isAudio||(videoAiGender="female",videoVoice="1bd001e7e50f421d891986aad5158bc8");const i=!videoAiGender||videoAiGender.toLowerCase()===e.gender.toLowerCase();if(!0===e.support_interactive_avatar&&i){const i=n||"";let o=new Option(e.language+","+i,e.voice_id);t.options[t.options.length]=o,videoVoice&&videoVoice===e.voice_id&&(o.selected=!0)}}))}))})),speechRecognition&&!isIOS&&(recognition=new(window.SpeechRecognition||window.webkitSpeechRecognition),recognition.continuous=!0,recognition.interimResults=!1,recognition.maxAlternatives=5,pageLanguage&&(recognition.lang=pageLanguage),recognition.addEventListener("start",(()=>{chatSpeechStartButton.classList.add("activeControl"),setTooltip("chatSpeechStartButton",smartVideo.msgStore.chatSpeechStop,"top")})),recognition.addEventListener("result",(e=>{let t=e.resultIndex,n=e.results[t][0].transcript;n&&sendVideoAi(n)})),recognition.addEventListener("error",(e=>{console.warn("Speech recognition error",e.error),setTimeout((()=>{canUnmute&&"no-speech"===e.error&&(chatSpeechStartButton.classList.add("activeControl"),speechRecognition&&startSpeech(!0))}),200)})),recognition.addEventListener("end",(()=>{chatSpeechStartButton.classList.remove("activeControl"),setTooltip("chatSpeechStartButton",smartVideo.msgStore.chatSpeechStart,"top")})));let t=!0;duration&&(t=checkAppointment()),t?(hrefUrl.protocol+"//"+hrefUrl.host=="https://www.new-dev.com"&&setTimeout((()=>{setNotify("info","Sorry, but this is a demo site and chat with the avatars are time limited.","top",1e4),setTimeout((()=>{exit()}),1e4)}),15e4),initRoom()):cleanAll()}else cleanAll(),setNotify("error",smartVideo.msgStore.roomNotAllowed,"center",1e5)}))}))}else cleanAll(),setNotify("info",smartVideo.msgStore.roomDoesNotExists,"top",1e4),setTimeout((()=>{window.location="./"}),1e4)}))}))})).catch((t=>{console.warn("Get locales failed, trying default",t),"en_US"!=e&&smartVideo.setLanguage("en_US")}))},initMsgStore:function(e){smartVideo.setLanguage(e.lang)},init:function(){postData("server/script.php",{type:"getpk"}).then((e=>{e.text().then((function(e){const t={stringify:function(e){let t={ct:e.ciphertext.toString(CryptoJS.enc.Base64)};return e.iv&&(t.iv=e.iv.toString()),e.salt&&(t.s=e.salt.toString()),JSON.stringify(t)},parse:function(e){let t=JSON.parse(e),n=CryptoJS.lib.CipherParams.create({ciphertext:CryptoJS.enc.Base64.parse(t.ct)});return t.iv&&(n.iv=CryptoJS.enc.Hex.parse(t.iv)),t.s&&(n.salt=CryptoJS.enc.Hex.parse(t.s)),n}},n='{"ct":"'+e+'","iv":"09644439296d0d45c81236b5643e9662","s":"3132333435363738"}';if(CryptoJS.AES.decrypt(n,"aeNbaecqgc",{format:t}).toString(CryptoJS.enc.Utf8)){const e={lang:"en_US"};smartVideo.initMsgStore(e)}}))}))}};window.smartVideo=smartVideo,smartVideo.init();